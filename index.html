<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TopSkin - Productos</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baumans&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background-image: url('media/fondo2-1.jpg');;
      background-position: center center;
      background-size: cover;
    }

    /* ===== HEADER ===== */
    .header {
      position: relative;
      background: url('media/fondo1.jpg');
      height: 200px;
      background-size: cover;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .header-top {
      width: 90%;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo{
      display: flex;
      justify-content: center; 
      align-items: center;   
      width: 100%;
      margin-bottom: auto;
    }

    .logo img {
      height: 100px;
      display: inline-block; 
      margin-left: 150px;
    }

    .header-icons {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-icons a {
      color: inherit; 
      text-decoration: none;
    }
    .header-icons a:hover {
      color: #061b15; 
    }

    .header-icons i {
      font-size: 20px;
      cursor: pointer;
    }

    .user-logo {
      margin-left: 10px;
      font-weight: bold;
      font-family: 'Baumans', cursive;
    }

    /* ===== MENU FLOTANTE ===== */
    .nav {
      font-family: 'Baumans', cursive;
      position: sticky;
      font-size: 23px;
      top: 0;
      display: flex;
      justify-content: center;
      gap: 15px;
      background: #8cb6a4;
      padding: 10px 15px;
      border-radius: 30px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      z-index: 10;
      margin-top: -30px; 
    }

    .nav a {
      text-decoration: none;
      color: #ffffff;
      font-weight: 500;
      padding: 8px 18px;
      transition: 0.3s;
      border-radius: 30px;
    }

    .nav a:hover {
      background: #4a9d8a;
      color: white;
    }

    /* ===== HERO ===== */
    .hero {
      width: 100%;
      height: 450px;
      background-image:url('media/image4.png');
      background-position: center center;
      background-size:cover;
      background-repeat: no-repeat;
      display: flex;
      align-items: center;

    }

    .hero h1 {
      text-align: left;
      font-weight:lighter ;
      font-family: "Open Sans", sans-serif;
      font-size: 50px;
      margin-bottom: 30px;
      margin-left: 60px;
      background-color: #bed1cc9d;
    }

    .hero p {
      font-family: "Open Sans", sans-serif;
      font-weight: bold;
      font-size: 15px;
      margin-left: 60px;
      margin-bottom: 60px;
      background-color: #bed1cc9d;
    }

    /* ===== PRODUCTOS ===== */
    .section-title {
      font-family: 'Baumans', cursive;
      text-align: center;
      font-size: 36px;
      color: #2d3a37;
      margin: 60px 0 30px 0;
    }

    .productos-grid {
      display: grid;
      font-family: 'Baumans', cursive;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      max-width: 1400px;
      margin: 0 auto 50px auto;
      padding: 0 20px;
    }

    .card {
      background: #dfe7ee;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 5px;
    }

    .card h3 {
      font-size: 16px;
      margin: 10px 0 5px;
    }

    .card .precio {
      font-weight: bold;
      color: #4a9d8a;
    }

    /*===== POPUP PRODUCTOS ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .modal {
      background-image: url('media/fondo3.png');
      background-color: #4a9d8a;
      font-family: 'Baumans', cursive;
      width: 92%;
      max-width: 480px;
      border-radius: 10px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      position: relative;
    }
    .modal .cerrar {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 32px;     
      height: 32px;   
      background: #4a9d8a;
      border-radius: 6px; 
      color: white;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      line-height: 32px; 
      cursor: pointer;
      user-select: none; 
      transition: 0.2s;
      z-index: 10;
    }

    .modal img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 12px;
    }

    .modal .acciones {
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-top:12px;
    }
    .modal .cantidad {
      display:flex;
      gap:8px;
      align-items:center;
    }
    .modal .cantidad input {
      width:68px;
      padding:6px;
      border-radius:6px;
      border:1px solid #ddd;
      text-align:center;
    }
    .modal button.agregar {
      padding:10px 16px;
      background:#4a9d8a;
      color:white;
      border:none;
      border-radius:8px;
      cursor:pointer;
    }

    .popup-usuario,
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      animation: fadeIn 0.2s ease;
    }

    .popup-contenido,
    .modal {
      font-family: 'Baumans', cursive;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      width: 90%;
      max-width: 380px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      position: relative;
      animation: popupZoom 0.25s ease;
    }

    /* BTN CERRAR */
    .cerrarlogin {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 32px;     
      height: 32px;   
      background: #4a9d8a;
      border-radius: 6px; 
      color: white;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      line-height: 32px; 
      cursor: pointer;
      user-select: none; 
      transition: 0.2s;
    }

    .cerrarlogin:hover {
      background: #3c8977;
      color: #fff;
    }

    .popup-contenido button {
      font-family: 'Baumans', cursive;
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: none;
      border-radius: 6px;
      background: #4a9d8a;
      color: white;
      cursor: pointer;
      font-size: 16px;
      transition: 0.2s;
    }

    .popup-contenido button:hover {
      background: #3c8977;
    }

    /* ANIMACIONES */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes popupZoom {
      from { transform: scale(0.7); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* POPUP DEL PRODUCTO */
    .modal img {
      width: 100%;
      border-radius: 10px;
    }

    .modal button {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      background: #4a9d8a;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-size: 16px;
    }

    .modal button:hover {
      background: #3b7d6c;
    }

    .user-logo{
      font-family: 'Baumans', cursive;
    }
    /* ===== PANEL DE BÚSQUEDA ===== */
    .busqueda-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    /* Panel lateral */
    .busqueda-panel {
      font-family: 'Baumans', cursive;
      width: 320px;
      height: 100%;
      background: #aababd;
      padding: 20px;
      position: fixed;
      top: 0;
      left: 0;
      box-shadow: 2px 0 10px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease forwards;
    }

    @keyframes slideIn {
      from { transform: translateX(-100%); }
      to   { transform: translateX(0); }
    }

    .busqueda-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .cerrar-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    /* Input */
    .input-busqueda {
      font-family: 'Baumans', cursive;
      width: 90%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin: 15px 0;
    }

    /* Resultados */
    .resultados {
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      padding-right: 5px;
    }

    .resultados::-webkit-scrollbar {
      width: 6px;
    }

    .resultados::-webkit-scrollbar-thumb {
      background-color: rgba(0,0,0,0.3);
      border-radius: 3px;
    }

    .resultados::-webkit-scrollbar-track {
      background: transparent;
    }

    .resultado-item {
      display: flex;
      gap: 12px;
      padding: 10px 0;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }

    .resultado-item img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 6px;
    }

    .resultado-item h4 {
      margin: 0;
      font-size: 16px;
    }

    .resultado-item p {
      margin: 0;
      font-size: 13px;
      color: #666;
    }

  </style>
</head>
<body>

<div id="app">
  <!-- HEADER -->
  <header class="header">
    <div class="header-top">

      <!-- LOGO -->
      <div class="logo">
        <img src="media/logo_1.png" alt="TopSkin">
      </div>

      <!-- ICONOS DERECHA -->
      <div class="header-icons">
        <i class="fas fa-search" @click="abrirBusqueda" style="cursor:pointer;"></i>

        <a href="src/cliente/carrito.html">
          <i class="fas fa-shopping-cart"></i>
        </a>

        <!-- PANEL DE BÚSQUEDA -->
        <div v-if="mostrarBusqueda" class="busqueda-overlay" @click.self="cerrarBusqueda">
          <div class="busqueda-panel">
            <div class="busqueda-header">
              <h3>Buscar productos</h3>
              <button class="cerrar-btn" @click="cerrarBusqueda">X</button>
            </div>

            <input type="text" v-model="busqueda" placeholder="Buscar por nombre o marca..." class="input-busqueda">

            <div class="resultados">
              <div v-for="p in productosFiltrados" :key="p.id" class="resultado-item" @click="abrirPopupProducto(p)">
                <img :src="p.foto" alt="">
                <div>
                  <h4>{{ p.nombre }}</h4>
                  <p>{{ p.marca }}</p>
                </div>
              </div>

              <p v-if="productosFiltrados.length === 0">No se encontraron productos</p>
            </div>
          </div>
        </div>

        <!-- Si NO está logueado -->
        <div v-if="!cliente" class="user-logo" @click="abrirUsuario" style="cursor:pointer">
          Usuario
        </div>

        <!-- Si está logueado -->
        <div v-else class="user-logo" @click="abrirUsuario" style="cursor:pointer">
          {{ nombreMostrar }}
        </div>

      </div>
    </div>
  </header>

  <!-- POPUP LOGIN/REGISTRO -->
  <div v-if="mostrarPopup" class="popup-usuario" @click.self="cerrarUsuario">
    <div class="popup-contenido">
      <h3>No estas logueado</h3>
      <button @click="irLogin">Inicia Sesión</button>
      <button @click="irRegistro">Registrate</button>
      <div class="cerrarlogin" @click="cerrarUsuario">X</div>
    </div>
  </div>

  <!-- MENU FLOTANTE -->
  <nav class="nav">
    <a href="#">Menú Principal</a>
    <a href="src/cliente/catalogo.html">Catalogo</a>
    <a href="#">Sobre Nosotros</a>
    <a href="#">Mis Pedidos</a>
  </nav>

  <!-- HERO -->
  <section class="hero">
    <div>
      <h1>REVIVE TU PIEL</h1>
      <p>NUEVO SET DE HIDRATACIÓN, LO QUE <br>BUSCAS PARA ILUMINAR TU PIEL</p>
    </div>
  </section>

  <!-- NUEVOS PRODUCTOS -->
  <h2 class="section-title">Nuevos Productos</h2>

<div class="productos-grid">
  <div v-for="p in productosFiltrados" :key="p.id" class="card" @click="abrirPopupProducto(p)">

      <img :src="p.foto" :alt="p.nombre">
      <h3>{{ p.nombre }}</h3>
      <div class="precio">{{ Number(p.precio) }} Bs</div>
    </div>
  </div>

  <!-- POPUP  -->
  <div v-if="productoSeleccionado" class="modal-overlay" @click.self="cerrarPopupProducto">
    <div class="modal">
      <div class="cerrar" @click="cerrarPopupProducto">x</div>

      <img :src="productoSeleccionado.foto" :alt="productoSeleccionado.nombre">
      <h2>{{ productoSeleccionado.nombre }}</h2>
      <p>{{ productoSeleccionado.info || 'Descripción adicional aquí' }}</p>

      <div>
        <label>Cantidad:</label>
        <input type="number" v-model.number="cantidad" min="1" style="width:60px;">
      </div>

      <button @click="agregarAlCarrito(productoSeleccionado, cantidad)">
        Agregar al carrito
      </button>
      
    </div>
  </div>

  <!-- PRODUCTOS POR MARCA -->
  <h2 class="section-title">Productos por Marca</h2>
  <div v-for="m in marcas" :key="m.marca" style="margin-bottom:40px;">
    <h3 style="color:#364441; margin-bottom:15px; margin-left: 20px; font-family: 'Baumans', cursive; font-size: 25px;">
      {{ m.marca }}
    </h3>
    <div class="productos-grid">
      <div v-for="p in m.productos" :key="p.id" class="card" @click="abrirPopupProducto(p)">
        <img :src="p.foto" :alt="p.nombre">
        <h3>{{ p.nombre }}</h3>
        <div class="precio">{{ Number(p.precio) }} Bs</div>
      </div>
    </div>
  </div>

</div>

  <script>
    const { createApp, ref, onMounted, computed } = Vue;
    createApp({
      setup() {
        const mostrarBusqueda = ref(false);
        function abrirBusqueda() {
          mostrarBusqueda.value = true;
        }

        function cerrarBusqueda() {
          mostrarBusqueda.value = false;
          busqueda.value = "";
        }

        const busqueda = ref("");
        const productosFiltrados = computed(() => {
          if (!Array.isArray(productos.value)) return [];

          const texto = busqueda.value.trim().toLowerCase();
          if (!texto) return productos.value;

          return productos.value.filter(p => {
            const nombre = (p.nombre || "").toLowerCase();
            const marca = (p.marca || "").toLowerCase(); 
            return nombre.includes(texto) || marca.includes(texto);
          });
        });

        // --- USUARIO ---s
        const cliente = ref(null);
      try {
          const data = localStorage.getItem('cliente');
          if (data) cliente.value = JSON.parse(data);
      } catch(e) {
          console.warn('Datos corruptos en localStorage cliente → se limpiaron');
          localStorage.removeItem('cliente');
      }

              const mostrarPopup = ref(false);

              // Computed para mostrar el nombre completo
              const nombreMostrar = computed(() => {
              if (!cliente.value) return '';
              const u = cliente.value;
              return `${u.nombre1 || ''} ${u.apellidoP || ''}`.trim() || 'Cliente';
              });

              function abrirUsuario() {
                if (cliente.value) {
                  window.location.href = 'src/cliente/cuentacln.html';
                } else {
                  mostrarPopup.value = true;
                }
              }

              function irLogin() {
                window.location.href = 'login.html';
              }

              function irRegistro() {
                window.location.href = 'src/cliente/registro.html';
              }

              function cerrarUsuario() {
                mostrarPopup.value = false;
              }

              // --- PRODUCTOS Y MARCAS ---
              const productos = ref([]);
              const marcas = ref([]);

              // --- POPUP PRODUCTO ---
              const productoSeleccionado = ref(null);
              const cantidad = ref(1);
              // --- CARRITO ---
              const carrito = ref([]);

              function abrirPopupProducto(p) {
                productoSeleccionado.value = {
                  ...p,
                  info: p.info || ''
                };
                cantidad.value = 1;
              }

              function cerrarPopupProducto() {
                productoSeleccionado.value = null;
              }

              function agregarAlCarrito(p, cantidadSeleccionada = 1) {

        const idProducto = p.idProducto || p.id;

        if (!idProducto) {
          console.error("Producto sin ID:", p);
          return;
        }

        let index = carrito.value.findIndex(x => x.idProducto === idProducto);
        if (index !== -1) {
          carrito.value[index].cantidad += cantidadSeleccionada;
        } else {
          carrito.value.push({ ...p, cantidad: cantidadSeleccionada, idProducto });
        }

        const soloParaBackend = carrito.value.map(x => ({
          idProducto: x.idProducto,
          cantidad: x.cantidad
        }));

        fetch(`backend/actualizar_carrito.php?ci=${cliente.value.ciCliente}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(soloParaBackend)
        })

          .then(r => r.json())
          .then(res => {
            console.log('Carrito actualizado:', res);
          })
          .catch(err => console.error('Error guardando carrito:', err));

        alert(`¡${cantidadSeleccionada} ${p.nombre} agregado(s) al carrito!`);
        cerrarPopupProducto();
      }

        onMounted(() => {
          fetch('backend/index.php')
            .then(res => res.json())
            .then(data => productos.value = data)
            .catch(err => console.error('Error cargando productos:', err));

          fetch('backend/productosmarca.php')
            .then(res => res.json())
            .then(data => marcas.value = data)
            .catch(err => console.error('Error cargando marcas:', err));
        });

        return {
          mostrarBusqueda,
          abrirBusqueda,
          cerrarBusqueda,
          busqueda,
          productosFiltrados,
          cliente,
          nombreMostrar,
          mostrarPopup,
          abrirUsuario,
          cerrarUsuario,
          irLogin,
          irRegistro,
          productos,
          marcas,
          carrito,
          productoSeleccionado,
          cantidad,
          abrirPopupProducto,
          cerrarPopupProducto,
          agregarAlCarrito
        };
      }
    }).mount('#app');
  </script>
</body>
</html>


